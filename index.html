<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>#Hashtag Reducer</title>

    <style>
        html,
        body {
            height: 100%;
        }

        body {
            display:          flex;
            align-items:      center;
            padding-top:      40px;
            padding-bottom:   40px;
            background-color: #f5f5f5;
        }

        .form-signin {
            width:     100%;
            max-width: 530px;
            padding:   15px;
            margin:    auto;
        }

        textarea {
            min-height: 240px !important;
        }

        .form-signin .form-floating:focus-within {
            z-index: 2;
        }

    </style>


</head>
<body>
<main class="form-signin">
    <form id="hashtags-form">
        <img class="mb-4" src="https://emotion-tracker.dev/img/logo.svg" alt="" height="57">

        <div class="row" id="category-place"></div>

        <h3 class="h6 my-3 fw-normal">Please insert text</h3>

        <div class="form-floating mb-4">
            <textarea rows="5" class="form-control" id="text"> </textarea>
            <label for="text">Text with hashtags</label>
        </div>

        <button class="w-100 btn btn-lg btn-primary" type="button" onclick="clearAndCopyHashtags()">Clear and copy
                                                                                                    hashtags
        </button>


    </form>
</main>


<template id="category-container">
    <div class="col-12">
        <h3 class="h6 my-3 fw-normal">{title}</h3>

        <div class="row">
            {content}
        </div>
    </div>
</template>

<template id="category-item">
    <div class="col-12 mb-2">
        <input type="checkbox" class="btn-check" id="{slug}" value="{slug}" autocomplete="off">
        <label class="btn btn-outline-primary" for="{slug}">{name}</label>
    </div>
</template>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

<script>


    let category = [
        'Setting.Time.Day Job.Work',
        'Setting.Time.Day Job.Compensation',
        'Setting.Time.Day Job.Holidays',
        'Setting.Time.AM.Work',
        'Setting.Time.Weekend',
        'Setting.Time.Public Holidays',
        'Setting.Time.Leisure',
        'Setting.Time.Vacation',
        'Setting.Places.Zug.Home',
        'Setting.Places.Zug.Home.Bus Stop',
        'Setting.Places.Zug.Herti.Bus Stop',
        'Setting.Places.Zug.Herti.Migros',
        'Setting.Places.Zug.Herti.Denner',
        'Setting.Places.Zug.Herti.Kiosk',
        'Setting.Places.Zug.Train Station',
        'Setting.Places.Zug.Metalli.Migros',
        'Setting.Places.Zug.Metalli.Denner',
        'Setting.Places.Zug.Metalli.Coiffur',
        'Setting.Places.Zug.Metalli.Headshop',
        'Setting.Places.Zug.Metalli.Bus Stop',
        'Setting.Places.Zug.V-ZUG.Bus Stop',
        'Setting.Places.Zug.V-ZUG.Waller',
        'Setting.Places.Zug.V-ZUG.Zugorama',
        'Setting.Places.Zug.Mantra',
        'Setting.Places.Oberwil.Bus Stop',
        'Setting.Places.Oberwil.Train Station',
        'Setting.Places.Oberwil.AM Office',
        'Setting.Places.Oberwil.Roli\'s Home',
        'Setting.Places.Affoltern am Albis.Train Station',
        'Setting.Places.Affoltern am Albis.Doc',
        'Setting.Places.Hedingen.Train Station',
        'Setting.Places.Hedingen.Pascal\'s Home',
        'Setting.Places.Steinhausen.Train Station',
        'Setting.Places.Steinhausen.Patrick\'s Home',
        'Movement.No travel',
        'Movement.Stairs',
        'Movement.Walking',
        'Movement.E-Bike',
        'Movement.E-Scooter',
        'Movement.Bus',
        'Movement.Train',
        'Movement.Car.Guest',
        'Movement.Car.Taxi',
        'Movement.Boat.Private',
        'Movement.Boat.Public',
        'Movement.Airplane',
        'Sleep.Time.None',
        'Sleep.Time.Early',
        'Sleep.Time.Normal',
        'Sleep.Time.Late',
        'Sleep.Recovery.Bad',
        'Sleep.Recovery.Medium',
        'Sleep.Recovery.Good',
        'Sleep.Sweat.None',
        'Sleep.Sweat.Little',
        'Sleep.Sweat.Medium',
        'Sleep.Sweat.Lot',
        'Sleep.Dreams.None',
        'Sleep.Dreams.Positive',
        'Sleep.Dreams.Neutral',
        'Sleep.Dreams.Negative',
        'Personal Care.Toothbrushing',
        'Personal Care.Shower',
        'Personal Care.Shower.Hair',
        'Personal Care.Facial care',
        'Personal Care.Shaving',
        'Personal Care.Nails',
        'Fitness.Exercise.Breath',
        'Fitness.Exercise.Meditation',
        'Fitness.Exercise.Wand Push-Ups',
        'Fitness.Exercise.Treadmill',
        'Fitness.Measure.Scale',
        'Fitness.Measure.Blood Pressure',
        'Fitness.Measure.Emotion-Tracking',
        'Fitness.State.Lazy',
        'Fitness.State.Drunk',
        'Fitness.State.Hangover',
        'Fitness.State.Hangover.Small',
        'Fitness.State.Hangover.Medium',
        'Fitness.State.Hangover.Big',
        'Food.Time.Breakfast',
        'Food.Time.Lunch',
        'Food.Time.Dinner',
        'Food.Time.Late',
        'Food.Calories.Very low',
        'Food.Calories.Low',
        'Food.Calories.Medium',
        'Food.Calories.High',
        'Food.Calories.Very high',
        'Food.Calories.Binge',
        'Food.Source.Homemade',
        'Food.Source.Ready meal',
        'Food.Source.Takeaway',
        'Food.Source.Delivery',
        'Food.Source.Restaurant',
        'Food.Type.Meal replacement',
        'Food.Type.Bread',
        'Food.Type.Pasta',
        'Food.Type.Pizza',
        'Food.Type.Rice',
        'Food.Type.Meat',
        'Food.Type.Milk products',
        'Food.Type.Vegetables',
        'Food.Type.Fruits',
        'Food.Type.Junk Food',
        'Food.Type.Snacks',
        'Food.Type.Snacks.Sweet',
        'Food.Type.Snacks.Salty',
        'Drinking.Water.None',
        'Drinking.Water.Low',
        'Drinking.Water.Medium',
        'Drinking.Water.High',
        'Drinking.Coffein.None',
        'Drinking.Soda.None',
        'Drugs.Vitamins.D3',
        'Drugs.Vitamins.K2',
        'Drugs.Vitamins.Multivitamin',
        'Drugs.Vaping',
        'Drugs.Vaping.Low',
        'Drugs.Vaping.Medium',
        'Drugs.Vaping.High',
        'Drugs.Alcohol',
        'Drugs.Alcohol.Low',
        'Drugs.Alcohol.Medium',
        'Drugs.Alcohol.High',
        'Chores.Private.Laundry',
        'Chores.Private.Admin.Todo.Used',
        'Chores.Private.Admin.Calendar.Used',
        'Chores.Private.Admin.E-Mails.Checked',
        'Chores.Private.Admin.E-Mails.Sent',
        'Chores.Private.Admin.Post',
        'Chores.Private.Admin.Post.Postbox',
        'Chores.Private.Admin.Post.Scanning',
        'Chores.Private.Admin.Post.Financial',
        'Chores.Private.Cleaning',
        'Chores.Private.Cleaning.Living room',
        'Chores.Private.Cleaning.Kitchen',
        'Chores.Private.Cleaning.Bathroom',
        'Chores.Private.Cleaning.Bedroom',
        'Chores.Private.Cleaning.Office',
        'Chores.Private.Cleaning.Balcony',
        'Chores.Private.Cleaning.Basement',
        'Chores.Private.Cleaning.Trash',
        'Chores.Private.Shopping',
        'Chores.Private.Shopping.Offline',
        'Chores.Private.Shopping.Online',
        'Chores.Private.Shopping.Groceries',
        'Chores.Private.Shopping.Clothes',
        'Chores.Private.Shopping.Household',
        'Chores.Private.Shopping.Health',
        'Chores.Private.Shopping.Technology',
        'Chores.Private.Maintenance.Hardware',
        'Chores.Private.Maintenance.Software',
    ];

    let collection = {};

    category.forEach((item) => {
        let full = item.split('.')

        let value = full.pop();
        let title = full.join(' ');

        collection.hasOwnProperty(title)
            ? collection[title].push(value)
            : collection[title] = [value];
    });


    Object.entries(collection).forEach((values) => {

        let items = values[1].map((tag) => createCategoryItemsTemplate(tag,  values[0])).join(' ');

        let template = document.querySelector('#category-container');
        let clone = template.content.querySelector('div').cloneNode(true);

        document.querySelector('#category-place').innerHTML += clone.outerHTML
            .replace(/{content}/g, items)
            .replace(/{title}/g, values[0]);
    });

    /**
     *
     * @param name
     * @returns {string}
     */
    function createCategoryItemsTemplate(name, title) {

        let template = document.querySelector('#category-item');
        let clone = template.content.querySelector('div').cloneNode(true);

        let hashtag = createHashTag(title + '.' + name)

        return clone.outerHTML
            .replace(/{slug}/g, hashtag)
            .replace(/{name}/g, name);
    }

    /**
     *
     * @param text
     * @returns {string}
     */
    function createHashTag(text) {
        return '#' + text.replaceAll(' ', '_').replaceAll('.', 'ãƒ¼').toLowerCase();
    }

    /**
     *
     * @param searchText
     * @returns {*}
     */
    function findHashtags(searchText) {
        var regexp = /(#[^\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%()*,.\/:;<=>?@\[\]^`{|}~]+)/g
        return searchText.match(regexp);
    }

    function clearAndCopyHashtags() {
        var textarea = document.getElementById('text');

        let hashtagsForText = findHashtags(textarea.value.replace(/-/g, "_"))

        textarea.value = Array.isArray(hashtagsForText) ? hashtagsForText.join(' ') : hashtagsForText;

        Array.from(document.querySelectorAll("input[type=checkbox]:checked"), element => {
            textarea.value += ' ' + element.value;
        });

        textarea.select()
        document.execCommand("copy")
    }
</script>


</body>
</html>
